{% extends "base.html" %}

{% block title %}Scam Detection - CyberGuard{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="card mb-3">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 style="color: var(--accent-blue); margin-bottom: 0.5rem;">
                    üîç AI Scam Detection
                </h1>
                <p style="color: var(--text-gray); margin: 0;">
                    Analyze suspicious messages with advanced AI-powered fraud detection technology.
                </p>
            </div>
            <div class="text-center">
                <div style="font-size: 3rem; color: var(--accent-blue);">ü§ñ</div>
                <small style="color: var(--text-gray);">AI Enhanced</small>
            </div>
        </div>
    </div>

    <!-- Detection Form -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üìù Analyze Suspicious Content</h3>
        </div>
        <form method="POST" class="mt-3">
            <div class="form-group">
                <label for="text_input" class="form-label">
                    <span style="color: var(--accent-blue);">üìÑ</span> Message Content
                </label>
                <textarea 
                    id="text_input" 
                    name="text_input" 
                    class="form-control" 
                    placeholder="Paste suspicious email, SMS, or message content here for analysis..."
                    rows="8"
                    required
                >{{ analyzed_text if analyzed_text else '' }}</textarea>
                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">
                    üí° Tip: Include the full message including sender information, links, and any attachments mentioned.
                </small>
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-primary w-100">
                    üîç Analyze Message
                </button>
            </div>
        </form>
    </div>

    <!-- Detection Results -->
    {% if result %}
    <div class="card mt-3">
        <div class="card-header">
            <h3 class="card-title">üõ°Ô∏è Analysis Results</h3>
        </div>
        
        <!-- Status and Confidence -->
        <div class="detection-result">
            <div class="result-header">
                <div>
                    {% if result.is_scam %}
                        <span class="result-status status-scam">üö® SCAM DETECTED</span>
                    {% elif result.risk_level == 'medium' %}
                        <span class="result-status status-suspicious">‚ö†Ô∏è SUSPICIOUS</span>
                    {% else %}
                        <span class="result-status status-safe">‚úÖ SAFE</span>
                    {% endif %}
                </div>
                <div class="text-right">
                    <div style="color: var(--accent-blue); font-size: 1.2rem; font-weight: bold;">
                        {{ "%.1f"|format(result.confidence * 100) }}% Confidence
                    </div>
                    <div style="color: var(--text-gray); font-size: 0.9rem;">
                        Risk Level: {{ result.risk_level.upper() }}
                    </div>
                </div>
            </div>
            
            <!-- Confidence Bar -->
            <div class="confidence-bar">
                <div class="confidence-fill" data-percentage="{{ (result.confidence * 100)|int }}"></div>
            </div>
        </div>

        <!-- Analyzed Text with Highlighted Keywords -->
        <div class="card mt-3">
            <div class="card-header">
                <h4 style="color: var(--accent-blue);">üìÑ Analyzed Content</h4>
            </div>
            <div style="background: rgba(42, 42, 42, 0.8); padding: 1.5rem; border-radius: 8px; font-family: monospace; white-space: pre-wrap; line-height: 1.6;">
                {% if result.keywords_found %}
                    {% set highlighted_text = analyzed_text %}
                    {% for keyword in result.keywords_found %}
                        {% set highlighted_text = highlighted_text.replace(keyword, '<span class="keywords-highlight">' + keyword + '</span>') %}
                    {% endfor %}
                    {{ highlighted_text|safe }}
                {% else %}
                    {{ analyzed_text }}
                {% endif %}
            </div>
        </div>

        <!-- Detected Indicators -->
        {% if result.indicators %}
        <div class="card mt-3">
            <div class="card-header">
                <h4 style="color: var(--accent-blue);">‚ö†Ô∏è Detected Threat Indicators</h4>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                {% for indicator in result.indicators %}
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger-red); border-radius: 8px; padding: 1rem;">
                    <div style="color: var(--danger-red); font-weight: bold; margin-bottom: 0.5rem;">
                        üö® {{ indicator }}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Keywords Found -->
        {% if result.keywords_found %}
        <div class="card mt-3">
            <div class="card-header">
                <h4 style="color: var(--accent-blue);">üîç Suspicious Keywords Detected</h4>
            </div>
            <div style="padding: 1rem;">
                {% for keyword in result.keywords_found %}
                    <span class="keywords-highlight">{{ keyword }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Detailed Explanation -->
        <div class="card mt-3">
            <div class="card-header">
                <h4 style="color: var(--accent-blue);">üìã Detailed Analysis</h4>
            </div>
            <div style="padding: 1rem;">
                <p style="color: var(--text-gray); line-height: 1.6; margin: 0;">
                    {{ result.explanation }}
                </p>
            </div>
        </div>

        <!-- Recommendations -->
        <div class="card mt-3">
            <div class="card-header">
                <h4 style="color: var(--accent-blue);">üí° Security Recommendations</h4>
            </div>
            <div style="padding: 1rem;">
                {% if result.is_scam %}
                <div style="background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--danger-red); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h5 style="color: var(--danger-red); margin-bottom: 0.5rem;">üö® IMMEDIATE ACTION REQUIRED</h5>
                    <ul style="color: var(--text-gray); margin: 0; padding-left: 1.5rem;">
                        <li>Do not click any links or download attachments</li>
                        <li>Do not provide any personal or financial information</li>
                        <li>Delete the message immediately</li>
                        <li>Report this to your email provider or platform</li>
                        <li>If you already clicked a link, scan your device for malware</li>
                    </ul>
                </div>
                {% elif result.risk_level == 'medium' %}
                <div style="background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning-orange); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h5 style="color: var(--warning-orange); margin-bottom: 0.5rem;">‚ö†Ô∏è PROCEED WITH CAUTION</h5>
                    <ul style="color: var(--text-gray); margin: 0; padding-left: 1.5rem;">
                        <li>Verify the sender through official channels</li>
                        <li>Check for spelling and grammar errors</li>
                        <li>Be suspicious of urgent requests</li>
                        <li>Do not provide sensitive information</li>
                    </ul>
                </div>
                {% else %}
                <div style="background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--success-green); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h5 style="color: var(--success-green); margin-bottom: 0.5rem;">‚úÖ APPEARS LEGITIMATE</h5>
                    <ul style="color: var(--text-gray); margin: 0; padding-left: 1.5rem;">
                        <li>No obvious scam indicators detected</li>
                        <li>Still exercise general caution</li>
                        <li>Verify sender if unsure</li>
                        <li>Keep your security software updated</li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Report This Scam -->
        {% if result.is_scam or result.risk_level == 'medium' %}
        <div class="card mt-3">
            <div class="card-header">
                <h4 style="color: var(--accent-blue);">üìù Help Protect Others</h4>
            </div>
            <div style="padding: 1rem; text-align: center;">
                <p style="color: var(--text-gray); margin-bottom: 1rem;">
                    Help improve our detection system and protect others by reporting this suspicious content.
                </p>
                <a href="{{ url_for('report_scam') }}" class="btn btn-danger">
                    üìù Report This Scam
                </a>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Tips Section -->
    <div class="card mt-3">
        <div class="card-header">
            <h3 class="card-title">üí° Detection Tips</h3>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            <div style="padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 8px; border-left: 4px solid var(--accent-blue);">
                <h6 style="color: var(--accent-blue); margin-bottom: 0.5rem;">üîç What to Look For</h6>
                <ul style="color: var(--text-gray); font-size: 0.9rem; margin: 0; padding-left: 1rem;">
                    <li>Urgent action requests</li>
                    <li>Requests for personal information</li>
                    <li>Suspicious links or attachments</li>
                    <li>Poor grammar and spelling</li>
                    <li>Unfamiliar sender addresses</li>
                </ul>
            </div>
            
            <div style="padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid var(--success-green);">
                <h6 style="color: var(--success-green); margin-bottom: 0.5rem;">‚úÖ Best Practices</h6>
                <ul style="color: var(--text-gray); font-size: 0.9rem; margin: 0; padding-left: 1rem;">
                    <li>Always verify sender identity</li>
                    <li>Use official communication channels</li>
                    <li>Enable two-factor authentication</li>
                    <li>Keep software updated</li>
                    <li>Trust your instincts</li>
                </ul>
            </div>
            
            <div style="padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border-left: 4px solid var(--warning-orange);">
                <h6 style="color: var(--warning-orange); margin-bottom: 0.5rem;">‚ö†Ô∏è Red Flags</h6>
                <ul style="color: var(--text-gray); font-size: 0.9rem; margin: 0; padding-left: 1rem;">
                    <li>Threats of legal action</li>
                    <li>Promises of easy money</li>
                    <li>Requests for immediate payment</li>
                    <li>Links to suspicious websites</li>
                    <li>Requests to download software</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Recent Scans -->
    <div class="card mt-3">
        <div class="card-header">
            <h3 class="card-title">üìä Recent Scans</h3>
        </div>
        <div style="padding: 1rem; text-align: center;">
            <p style="color: var(--text-gray); margin-bottom: 1rem;">
                View your scan history and track detection patterns.
            </p>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                üìà View Dashboard
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate confidence bars
    const confidenceBars = document.querySelectorAll('.confidence-fill');
    confidenceBars.forEach(bar => {
        const percentage = bar.getAttribute('data-percentage');
        if (percentage) {
            setTimeout(() => {
                bar.style.width = percentage + '%';
            }, 500);
        }
    });

    // Add character counter to textarea
    const textarea = document.getElementById('text_input');
    if (textarea) {
        const counter = document.createElement('div');
        counter.style.color = 'var(--text-gray)';
        counter.style.fontSize = '0.9rem';
        counter.style.marginTop = '0.5rem';
        textarea.parentNode.appendChild(counter);
        
        function updateCounter() {
            const length = textarea.value.length;
            counter.textContent = `${length} characters`;
            if (length > 1000) {
                counter.style.color = 'var(--warning-orange)';
            } else if (length > 500) {
                counter.style.color = 'var(--accent-blue)';
            } else {
                counter.style.color = 'var(--text-gray)';
            }
        }
        
        textarea.addEventListener('input', updateCounter);
        updateCounter();
    }

    // Add form validation
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const textInput = document.getElementById('text_input');
            if (textInput.value.trim().length < 10) {
                e.preventDefault();
                alert('Please enter at least 10 characters for analysis.');
                textInput.focus();
                return;
            }
            
            // Add loading state
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<span class="spinner"></span> Analyzing...';
            submitBtn.disabled = true;
        });
    }

    // Auto-resize textarea
    if (textarea) {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    }
});
</script>
{% endblock %}
